!function(o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):o(jQuery)}(function(g){!function(){"use strict";function o(o){return this.core=g(o).data("lightGallery"),this.core.s=g.extend({},a,this.core.s),this.core.s.zoom&&this.core.doCss()&&(this.init(),this.zoomabletimeout=!1,this.pageX=g(window).width()/2,this.pageY=g(window).height()/2+g(window).scrollTop()),this}var e,t,a={scale:1,zoom:!0,actualSize:!0,enableZoomAfter:300,useLeftForZoom:(e=!1,(t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./))&&parseInt(t[2],10)<54&&(e=!0),e)};o.prototype.init=function(){var i=this,o='<span id="lg-zoom-in" class="lg-icon"></span><span id="lg-zoom-out" class="lg-icon"></span>';i.core.s.actualSize&&(o+='<span id="lg-actual-size" class="lg-icon"></span>'),i.core.s.useLeftForZoom?i.core.$outer.addClass("lg-use-left-for-zoom"):i.core.$outer.addClass("lg-use-transition-for-zoom"),this.core.$outer.find(".lg-toolbar").append(o),i.core.$el.on("onSlideItemLoad.lg.tm.zoom",function(o,e,t){var a=i.core.s.enableZoomAfter+t;g("body").hasClass("lg-from-hash")&&t?a=0:g("body").removeClass("lg-from-hash"),i.zoomabletimeout=setTimeout(function(){i.core.$slide.eq(e).addClass("lg-zoomable")},a+30)});function e(o){var e=i.core.$outer.find(".lg-current .lg-image"),t=(g(window).width()-e.prop("offsetWidth"))/2,a=(g(window).height()-e.prop("offsetHeight"))/2+g(window).scrollTop(),r=(o-1)*(i.pageX-t),s=(o-1)*(i.pageY-a);e.css("transform","scale3d("+o+", "+o+", 1)").attr("data-scale",o),i.core.s.useLeftForZoom?e.parent().css({left:-r+"px",top:-s+"px"}).attr("data-x",r).attr("data-y",s):e.parent().css("transform","translate3d(-"+r+"px, -"+s+"px, 0)").attr("data-x",r).attr("data-y",s)}function n(){1<l?i.core.$outer.addClass("lg-zoomed"):i.resetZoom(),l<1&&(l=1),e(l)}function a(o,e,t,a){var r=e.prop("offsetWidth"),s=i.core.s.dynamic?i.core.s.dynamicEl[t].width||e[0].naturalWidth||r:i.core.$items.eq(t).attr("data-width")||e[0].naturalWidth||r;i.core.$outer.hasClass("lg-zoomed")?l=1:r<s&&(l=s/r||2),a?(i.pageX=g(window).width()/2,i.pageY=g(window).height()/2+g(window).scrollTop()):(i.pageX=o.pageX||o.originalEvent.targetTouches[0].pageX,i.pageY=o.pageY||o.originalEvent.targetTouches[0].pageY),n(),setTimeout(function(){i.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")},10)}var l=1,r=!1;i.core.$el.on("onAferAppendSlide.lg.tm.zoom",function(o,e){var t=i.core.$slide.eq(e).find(".lg-image");t.on("dblclick",function(o){a(o,t,e)}),t.on("touchstart",function(o){r?(clearTimeout(r),r=null,a(o,t,e)):r=setTimeout(function(){r=null},300),o.preventDefault()})}),g(window).on("resize.lg.zoom scroll.lg.zoom orientationchange.lg.zoom",function(){i.pageX=g(window).width()/2,i.pageY=g(window).height()/2+g(window).scrollTop(),e(l)}),g("#lg-zoom-out").on("click.lg",function(){i.core.$outer.find(".lg-current .lg-image").length&&(l-=i.core.s.scale,n())}),g("#lg-zoom-in").on("click.lg",function(){i.core.$outer.find(".lg-current .lg-image").length&&(l+=i.core.s.scale,n())}),g("#lg-actual-size").on("click.lg",function(o){a(o,i.core.$slide.eq(i.core.index).find(".lg-image"),i.core.index,!0)}),i.core.$el.on("onBeforeSlide.lg.tm",function(){l=1,i.resetZoom()}),i.core.isTouch||i.zoomDrag(),i.core.isTouch&&i.zoomSwipe()},o.prototype.resetZoom=function(){this.core.$outer.removeClass("lg-zoomed"),this.core.$slide.find(".lg-img-wrap").removeAttr("style data-x data-y"),this.core.$slide.find(".lg-image").removeAttr("style data-scale"),this.pageX=g(window).width()/2,this.pageY=g(window).height()/2+g(window).scrollTop()},o.prototype.zoomSwipe=function(){var r=this,s={},i={},n=!1,l=!1,c=!1;r.core.$slide.on("touchstart.lg",function(o){var e;r.core.$outer.hasClass("lg-zoomed")&&(e=r.core.$slide.eq(r.core.index).find(".lg-object"),c=e.prop("offsetHeight")*e.attr("data-scale")>r.core.$outer.find(".lg").height(),((l=e.prop("offsetWidth")*e.attr("data-scale")>r.core.$outer.find(".lg").width())||c)&&(o.preventDefault(),s={x:o.originalEvent.targetTouches[0].pageX,y:o.originalEvent.targetTouches[0].pageY}))}),r.core.$slide.on("touchmove.lg",function(o){var e,t,a;r.core.$outer.hasClass("lg-zoomed")&&(a=r.core.$slide.eq(r.core.index).find(".lg-img-wrap"),o.preventDefault(),n=!0,i={x:o.originalEvent.targetTouches[0].pageX,y:o.originalEvent.targetTouches[0].pageY},r.core.$outer.addClass("lg-zoom-dragging"),t=c?-Math.abs(a.attr("data-y"))+(i.y-s.y):-Math.abs(a.attr("data-y")),e=l?-Math.abs(a.attr("data-x"))+(i.x-s.x):-Math.abs(a.attr("data-x")),(15<Math.abs(i.x-s.x)||15<Math.abs(i.y-s.y))&&(r.core.s.useLeftForZoom?a.css({left:e+"px",top:t+"px"}):a.css("transform","translate3d("+e+"px, "+t+"px, 0)")))}),r.core.$slide.on("touchend.lg",function(){r.core.$outer.hasClass("lg-zoomed")&&n&&(n=!1,r.core.$outer.removeClass("lg-zoom-dragging"),r.touchendZoom(s,i,l,c))})},o.prototype.zoomDrag=function(){var r=this,s={},i={},n=!1,l=!1,c=!1,d=!1;r.core.$slide.on("mousedown.lg.zoom",function(o){var e=r.core.$slide.eq(r.core.index).find(".lg-object");d=e.prop("offsetHeight")*e.attr("data-scale")>r.core.$outer.find(".lg").height(),c=e.prop("offsetWidth")*e.attr("data-scale")>r.core.$outer.find(".lg").width(),r.core.$outer.hasClass("lg-zoomed")&&g(o.target).hasClass("lg-object")&&(c||d)&&(o.preventDefault(),s={x:o.pageX,y:o.pageY},n=!0,r.core.$outer.scrollLeft+=1,--r.core.$outer.scrollLeft,r.core.$outer.removeClass("lg-grab").addClass("lg-grabbing"))}),g(window).on("mousemove.lg.zoom",function(o){var e,t,a;n&&(a=r.core.$slide.eq(r.core.index).find(".lg-img-wrap"),l=!0,i={x:o.pageX,y:o.pageY},r.core.$outer.addClass("lg-zoom-dragging"),t=d?-Math.abs(a.attr("data-y"))+(i.y-s.y):-Math.abs(a.attr("data-y")),e=c?-Math.abs(a.attr("data-x"))+(i.x-s.x):-Math.abs(a.attr("data-x")),r.core.s.useLeftForZoom?a.css({left:e+"px",top:t+"px"}):a.css("transform","translate3d("+e+"px, "+t+"px, 0)"))}),g(window).on("mouseup.lg.zoom",function(o){n&&(n=!1,r.core.$outer.removeClass("lg-zoom-dragging"),!l||s.x===i.x&&s.y===i.y||(i={x:o.pageX,y:o.pageY},r.touchendZoom(s,i,c,d)),l=!1),r.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")})},o.prototype.touchendZoom=function(o,e,t,a){var r=this,s=r.core.$slide.eq(r.core.index).find(".lg-img-wrap"),i=r.core.$slide.eq(r.core.index).find(".lg-object"),n=-Math.abs(s.attr("data-x"))+(e.x-o.x),l=-Math.abs(s.attr("data-y"))+(e.y-o.y),c=(r.core.$outer.find(".lg").height()-i.prop("offsetHeight"))/2,d=Math.abs(i.prop("offsetHeight")*Math.abs(i.attr("data-scale"))-r.core.$outer.find(".lg").height()+c),g=(r.core.$outer.find(".lg").width()-i.prop("offsetWidth"))/2,u=Math.abs(i.prop("offsetWidth")*Math.abs(i.attr("data-scale"))-r.core.$outer.find(".lg").width()+g);(15<Math.abs(e.x-o.x)||15<Math.abs(e.y-o.y))&&(a&&(l<=-d?l=-d:-c<=l&&(l=-c)),t&&(n<=-u?n=-u:-g<=n&&(n=-g)),a?s.attr("data-y",Math.abs(l)):l=-Math.abs(s.attr("data-y")),t?s.attr("data-x",Math.abs(n)):n=-Math.abs(s.attr("data-x")),r.core.s.useLeftForZoom?s.css({left:n+"px",top:l+"px"}):s.css("transform","translate3d("+n+"px, "+l+"px, 0)"))},o.prototype.destroy=function(){var o=this;o.core.$el.off(".lg.zoom"),g(window).off(".lg.zoom"),o.core.$slide.off(".lg.zoom"),o.core.$el.off(".lg.tm.zoom"),o.resetZoom(),clearTimeout(o.zoomabletimeout),o.zoomabletimeout=!1},g.fn.lightGallery.modules.zoom=o}()});